const version="v2.13",DEBUG_MODE=!1,UPDATE_INTERVAL_IN_MS=12e4,MESSAGE_PANEL_WRAPPER_CLASS="alert_wrapper",MESSAGE_PANEL_WRAPPER_START="<div class='"+MESSAGE_PANEL_WRAPPER_CLASS+"'>",MESSAGE_PANEL_WRAPPER_END="</div>",MESSAGE_CLOSE_BTN_CLASS="close_alert",MESSAGE_CLOSE_BTN='<a class="'+MESSAGE_CLOSE_BTN_CLASS+'">×</a>',MESSAGE_BLOCK_START="<div class='alert_block'>",MESSAGE_BLOCK_END="</div>",MESSAGE_TITLE_START="<div class='alert_blockTitle'>Изменён раздел ",MESSAGE_TITLE_END="!</div>",MESSAGE_ITEMS_ROW_START="<div class='alert_blockItems'>",MESSAGE_ITEMS_ROW_END="</div>",MESSAGE_ITEM_ADDED_START="<span class='alert_addedItem'>",MESSAGE_ITEM_ADDED_END="</span>",MESSAGE_ITEM_DELETED_START="<span class='alert_deletedItem'>",MESSAGE_ITEM_DELETED_END="</span>";function saveCurrentInventory(){let e=JSON.stringify(getCurrentInventory());$.ajax({url:"/api.php",method:"post",dataType:"json",data:{token:ForumAPITicket,method:"storage.set",key:"backup_inventory",value:e},async:!1,success:function(e){}})}function getLastInventory(){let inventory;return $.ajax({url:"/api.php",method:"get",dataType:"json",data:{method:"storage.get",key:"backup_inventory"},async:!1,success:function(data){inventory=eval("("+data.response.storage.data.backup_inventory+")")}}),inventory}function getCurrentInventory(){var e=(new DOMParser).parseFromString(UserFld5,"text/html");let t=$(e.documentElement.textContent).find("a").attr("id"),E=new Date;E=E.getTime();let n=[];return n[0]=E,$.ajax({url:"/pages/"+t,method:"get",data:{token:ForumAPITicket},async:!1,success:function(e){let t=$(e);n[1]=$(t).find("#sm1").html(),n[2]=$(t).find("#sm2").html(),n[3]=$(t).find("#sm3").html(),n[4]=$(t).find("#sm4").html(),n[5]=$(t).find("#sm5").html()}}),n}function showAlertIfInventoryChanged(){let e=getLastInventory();if(!e)return void saveCurrentInventory();let t=getCurrentInventory();if(e[0]+UPDATE_INTERVAL_IN_MS>t[0]&&!DEBUG_MODE)return;if(e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&(saveCurrentInventory(),!DEBUG_MODE))return;let E="";for(let n=1;n<t.length;n++)if(e[n]!==t[n]){switch(E+=MESSAGE_BLOCK_START+MESSAGE_TITLE_START,n){case 1:E+='"Награды"';break;case 2:E+='"Артефакты"';break;case 3:E+='"Ачивки"';break;case 4:E+='"Иконки"';break;case 5:E+='"Подарки"'}E+=MESSAGE_TITLE_END,E+=MESSAGE_ITEMS_ROW_START,E+=getItems(e[n],t[n]),E+=MESSAGE_ITEMS_ROW_END+MESSAGE_BLOCK_END}saveCurrentInventory(),DEBUG_MODE&&(E='<div class="alert_block"><div class="alert_blockTitle">Изменён раздел "Артефакты"!</div><div class="alert_blockItems"><span class="alert_deletedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 1 тысячи слов"></span> <span class="alert_deletedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 2 тысячи слов"></span> <span class="alert_deletedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 3 тысячи слов"></span></div></div><div class="alert_block"><div class="alert_blockTitle">Изменён раздел "Подарки"!</div><div class="alert_blockItems"><span class="alert_addedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 1 тысячи слов"></span> <span class="alert_addedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 2 тысячи слов"></span> <span class="alert_addedItem"><img src="https://forumupload.ru/uploads/001a/b7/b5/5/169367.png" title="вместо 3 тысячи слов"></span></div></div>'),$("body").append(MESSAGE_PANEL_WRAPPER_START+MESSAGE_CLOSE_BTN+E+MESSAGE_PANEL_WRAPPER_END)}function closeAlertWindow(){console.log("Inventory alert closed."),$("."+MESSAGE_PANEL_WRAPPER_CLASS).hide(),$("body").remove("."+MESSAGE_PANEL_WRAPPER_CLASS)}function getItems(e,t){let E=e?splitItemsStringToArr(e.replace(/[\r\n\t]+/g,"").trim()):[],n=t?splitItemsStringToArr(t.replace(/[\r\n\t]+/g,"").trim()):[];for(var a=[],r=0;r<E.length;r++)-1===n.indexOf(E[r])&&a.push(MESSAGE_ITEM_DELETED_START+E[r]+MESSAGE_ITEM_DELETED_END);for(r=0;r<n.length;r++)-1===E.indexOf(n[r])&&a.push(MESSAGE_ITEM_ADDED_START+n[r]+MESSAGE_ITEM_ADDED_END);return a.join(" ")}function splitItemsStringToArr(e){let t=[];return $(e).filter("img").each((function(e,E){t.push(E.outerHTML.toString())})),t}console.log("init inventoryAlert plugin "+version),DEBUG_MODE&&console.log("DEBUG_MODE on"),showAlertIfInventoryChanged(),document.querySelectorAll("."+MESSAGE_CLOSE_BTN_CLASS).forEach((e=>e.addEventListener("click",(e=>{closeAlertWindow()}))));
